# 负载数据分析系统

一个基于Streamlit的Web应用程序，用于分析负载数据并计算逆变器发电量相关指标。

## 功能特性

- 📊 CSV文件读取和解析（支持多种编码）
- 🕐 时间范围选择和数据过滤
- ⚡ 逆变器发电量计算
- 📈 实时数据可视化
- 📋 详细结果展示
- 📥 结果导出为CSV

## 安装和运行

### 1. 克隆项目

```bash
git clone https://github.com/yourusername/load-data-analysis-system.git
cd 负载数据分析系统
```

### 2. 安装依赖

```bash
pip install -r requirements.txt
```

### 3. 运行应用

#### 方式一：使用批处理文件（Windows）
```bash
run.bat
```

#### 方式二：直接运行
```bash
python -m streamlit run main.py
```

#### 方式三：简化版命令行程序
```bash
python simple_analysis.py
```

### 4. 访问应用

在浏览器中打开 `http://localhost:8501`

## 使用说明

### 1. 文件上传
- 可以通过侧边栏上传CSV文件
- 系统会自动尝试多种编码格式读取文件
- 默认使用项目目录下的 `500KW不同模式的测试数据（负载）.csv`

### 2. 参数设置

#### 文件编码
- 支持自动检测（推荐）
- 手动选择：GBK、GB2312、UTF-8等

#### 时间范围
- 格式：HH:MM:SS（如 08:00:00）
- 系统会提取UTC时间列的时间部分进行过滤

#### 初始逆变器发电量
- 输入初始时刻的逆变器发电量（kW）
- 系统会自动验证并截断到合理范围

#### k表达式
- 支持常数：如 `0.01`
- 支持关于λ的表达式：如 `0.01*λ`, `0.01*λ^2`, `0.9*1/λ`
- 系统会自动解析并计算k值

### 3. 计算逻辑

系统按照以下公式进行计算：

```
购电 + 逆变器发电 = 负载
购电/负载 = λ
逆变器发电调节量 = k * λ² * 负载 * Δt
```

其中：
- Δt = 1秒
- k可以是常数或关于λ的表达式
- 所有数值保留一位小数（截断，不四舍五入）

### 4. 输出结果

#### 可视化图表
- 逆变器发电量百分比散点图
- 负载、逆变器发电量与发电量增加量对比图

#### 数据表格
包含以下列：
- 时间戳、UTC时间、设备地址、设备类型、负载数据
- 逆变器发电量
- 逆变器发电量占负载的百分比
- 逆变器发电调节量
- 激进调节量
- 逆变器发电调节量/激进调节量

#### CSV导出
可以下载完整的计算结果CSV文件

## 技术特点

- 🔧 自动处理中文路径和编码问题
- ⚠️ 实时数据验证和错误处理
- 🎨 现代化的Web界面
- 📱 响应式设计，支持不同屏幕尺寸
- ⚡ 高效的数据处理算法
- 🎨 马卡龙配色方案，视觉友好

## 注意事项

1. 确保CSV文件包含至少5列数据
2. 第二列应为UTC时间格式
3. 第五列应为负载数据
4. 时间格式必须为 HH:MM:SS
5. 负载数据应为非负数

## 故障排除

### 文件读取问题
- 检查文件路径是否正确
- 确认文件编码格式
- 验证CSV文件格式

### 计算错误
- 检查时间格式是否正确
- 验证k表达式语法
- 确认初始逆变器发电量设置

### 可视化问题
- 刷新页面重新加载
- 检查数据范围是否合理
- 确认时间范围设置

## 项目结构

```
负载数据分析系统/
├── main.py                 # 主要的Streamlit Web应用程序
├── simple_analysis.py      # 简化版命令行程序
├── requirements.txt        # Python依赖包列表
├── run.bat                # Windows启动脚本
├── README.md              # 项目说明文档
└── .gitignore             # Git忽略文件配置
```

## 贡献

欢迎提交Issue和Pull Request来改进这个项目。

## 许可证

MIT License
